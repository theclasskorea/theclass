<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>THE CLASS Catalogue (Image Viewer)</title>
  <style>
    :root { --gold:#f1d38b; }
    body { margin:0; background:#000; color:#fff; font-family:'Inter','Noto Sans KR',sans-serif; }
    .nav { position:sticky; top:0; z-index:10; background:#111; border-bottom:1px solid var(--gold); padding:12px; text-align:center;}
    .nav a { color:var(--gold); text-decoration:none; margin:0 10px; }
    .wrap { max-width:1080px; margin:0 auto; padding:10px 10px 40px; }
    .page { display:block; width:100%; height:auto; margin:0 0 8px; background:#111; border:0; }
    .skeleton { width:100%; aspect-ratio:16/9; background:linear-gradient(90deg,#111 25%,#1a1a1a 37%,#111 63%); background-size:400% 100%; animation:shimmer 1.4s infinite; margin:0 0 8px; }
    @keyframes shimmer { 0%{background-position:100% 0} 100%{background-position:0 0} }
    .top-btn { position:fixed; right:14px; bottom:18px; background:#111; border:1px solid var(--gold); color:#fff; border-radius:999px; padding:10px 14px; text-decoration:none; }
    @media (max-width:768px){ .wrap{padding:8px} }
  </style>
</head>
<body>
  <div class="nav">
    <a href="index.html">← Back to Menu</a> |
    <a href="bullet-img.html" style="color:#fff">View BULLET Catalogue →</a>
  </div>

  <div class="wrap" id="viewer"></div>
  <a class="top-btn" href="#">↑ Top</a>

  <script>
    const base = "img/theclass/page-"; // 루트에 / 안 붙임 (Pages 하위 경로 안전)
    const exts = [".webp",".jpg",".jpeg",".png"];
    const viewer = document.getElementById("viewer");

    const makeSkeleton = () => {
      const d = document.createElement("div");
      d.className = "skeleton";
      return d;
    };

    async function findUrl(n){
      const n2 = String(n).padStart(2,"0"), n1 = String(n);
      const candidates = [];
      for (const ext of exts){
        candidates.push(`${base}${n2}${ext}`);
        candidates.push(`${base}${n1}${ext}`);
      }
      for (const url of candidates){
        try {
          const r = await fetch(url,{method:"HEAD",cache:"no-store"});
          if (r.ok) return url;
        } catch(e){}
      }
      return null;
    }

    // 1번부터 차례로 탐색, 연속 3번 실패하면 종료
    (async () => {
      let n = 1, misses = 0;
      while (misses < 3 && n < 500){
        const holder = makeSkeleton();
        viewer.appendChild(holder);

        const url = await findUrl(n);
        if (!url) {
          holder.remove();
          misses++;
        } else {
          misses = 0;
          const img = document.createElement("img");
          img.loading = "lazy";
          img.decoding = "async";
          img.alt = `Page ${n}`;
          img.className = "page";
          img.src = url;
          img.addEventListener("load", ()=> holder.replaceWith(img));
          img.addEventListener("error", ()=> holder.remove());
        }
        n++;
      }
    })();
  </script>
</body>
</html>
